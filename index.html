<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HackForHomeless</title>
    <link rel="stylesheet" href="stylesheet.css">
    <script>
        function loadGoogleMaps(apiKey) {
            if (!apiKey) {
                console.error("Error: API key is missing.");
                alert("Error: Google Maps API key not found.");
                return;
            }
            const script = document.createElement("script");
            script.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initMap&v=weekly`;
            script.defer = true;
            document.head.appendChild(script);
        }
        fetch('config.json')
            .then(response => response.json())
            .then(config => loadGoogleMaps(config.GOOGLE_MAPS_API_KEY))
            .catch(error => console.error("Error loading API key:", error));
    </script>
</head>
<body>
    <header>
        <h1 class="logo">Hack4Homeless</h1>
        <nav>
            <ul>
                <li><a href="info">General Information</a></li>
                <li><a href="#tutoring">Tutoring Services</a></li>
                <li><a href="#libraries">Digital Libraries</a></li>
                <li><a href="#courses">Online Courses</a></li>
                <li><a href="#map">Community Outreach Map</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <section id="request-shelter">
            <h2>Request a Shelter to be Added to the Map</h2>
            <form id="shelter-request-form">
                <label for="shelter-name">Shelter Name:</label>
                <input type="text" id="shelter-name" required>
                <label for="shelter-address">Shelter Address:</label>
                <input type="text" id="shelter-address" required>
                <label for="shelter-lat">Latitude:</label>
                <input type="number" id="shelter-lat" step="any" required>
                <label for="shelter-lng">Longitude:</label>
                <input type="number" id="shelter-lng" step="any" required>
                <button type="submit">Submit Request</button>
            </form>
        </section>
        <section id="map">
            <h2>Community Outreach Map</h2>
            <div id="map" style="height: 500px; width: 100%;"></div>
        </section>
    </main>
    <script>
        let map, directionsService, directionsRenderer;
        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                zoom: 12,
                center: { lat: 38.9072, lng: -77.0369 },
            });
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);
            loadShelters();
        }
        document.getElementById("shelter-request-form").addEventListener("submit", function (e) {
            e.preventDefault();
            const shelter = {
                name: document.getElementById("shelter-name").value,
                address: document.getElementById("shelter-address").value,
                lat: parseFloat(document.getElementById("shelter-lat").value),
                lng: parseFloat(document.getElementById("shelter-lng").value)
            };
            new google.maps.Marker({
                position: { lat: shelter.lat, lng: shelter.lng },
                map: map,
                title: shelter.name
            });
            let shelters = JSON.parse(localStorage.getItem("shelters")) || [];
            shelters.push(shelter);
            localStorage.setItem("shelters", JSON.stringify(shelters));
            alert("Shelter request submitted successfully!");
            e.target.reset();
        });
        function loadShelters() {
            const shelters = JSON.parse(localStorage.getItem("shelters")) || [];
            shelters.forEach(shelter => {
                new google.maps.Marker({
                    position: { lat: shelter.lat, lng: shelter.lng },
                    map: map,
                    title: shelter.name
                });
            });
        }
    </script>
</body>
</html>
